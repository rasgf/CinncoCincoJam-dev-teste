#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Verifica se o √∫ltimo commit foi relacionado ao arquivo AI_CURSOR_RULES.md
LAST_COMMIT_FILES=$(git diff-tree --no-commit-id --name-only -r HEAD)
LAST_COMMIT_MSG=$(git log -1 --pretty=%B)

# Se o √∫ltimo commit cont√©m o arquivo AI_CURSOR_RULES.md ou a mensagem cont√©m "atualiza" e "guidelines", n√£o executa o script
if echo "$LAST_COMMIT_FILES" | grep -q "AI_CURSOR_RULES.md" || echo "$LAST_COMMIT_MSG" | grep -q -i "atualiza.*guidelines\|guidelines.*atualiza"; then
  echo "üîÑ Commit relacionado √†s diretrizes detectado. Pulando atualiza√ß√£o autom√°tica para evitar loop."
  exit 0
fi

# Atualiza o arquivo de diretrizes se houver novos commits relevantes
if npm run update-guidelines 2>/dev/null; then
  echo "‚úÖ Diretrizes atualizadas com sucesso"
else
  echo "‚ö†Ô∏è N√£o foi poss√≠vel atualizar as diretrizes, mas o commit foi conclu√≠do"
  exit 0  # N√£o falha o commit se o script falhar
fi 